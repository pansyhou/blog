"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3237],{4137:function(e,r,n){n.d(r,{Zo:function(){return d},kt:function(){return k}});var t=n(7294);function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function l(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function a(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?l(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=t.createContext({}),p=function(e){var r=t.useContext(c),n=r;return e&&(n="function"==typeof e?e(r):a(a({},r),e)),n},d=function(e){var r=p(e.components);return t.createElement(c.Provider,{value:r},e.children)},u={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},s=t.forwardRef((function(e,r){var n=e.components,o=e.mdxType,l=e.originalType,c=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),s=p(n),k=o,m=s["".concat(c,".").concat(k)]||s[k]||u[k]||l;return n?t.createElement(m,a(a({ref:r},d),{},{components:n})):t.createElement(m,a({ref:r},d))}));function k(e,r){var n=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var l=n.length,a=new Array(l);a[0]=s;var i={};for(var c in r)hasOwnProperty.call(r,c)&&(i[c]=r[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var p=2;p<l;p++)a[p]=n[p];return t.createElement.apply(null,a)}return t.createElement.apply(null,n)}s.displayName="MDXCreateElement"},1597:function(e,r,n){n.r(r),n.d(r,{assets:function(){return d},contentTitle:function(){return c},default:function(){return k},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return u}});var t=n(3117),o=n(102),l=(n(7294),n(4137)),a=["components"],i={id:"rk3568_Android11",slug:"/rk3568_Android11",title:"rk3568",authors:"pansyhou"},c=void 0,p={unversionedId:"skill/Android/rk3568_Android11",id:"skill/Android/rk3568_Android11",title:"rk3568",description:"SDK\u4e3a\u91ce\u706b2023.9.16\u7684",source:"@site/docs/skill/Android/rk3568A11.md",sourceDirName:"skill/Android",slug:"/rk3568_Android11",permalink:"/docs/rk3568_Android11",draft:!1,tags:[],version:"current",frontMatter:{id:"rk3568_Android11",slug:"/rk3568_Android11",title:"rk3568",authors:"pansyhou"}},d={},u=[{value:"\u65b0\u5efa\u4ea7\u54c1lunch",id:"\u65b0\u5efa\u4ea7\u54c1lunch",level:3},{value:"cooling",id:"cooling",level:2},{value:"\u98ce\u6247\u542f\u52a8\uff01",id:"\u98ce\u6247\u542f\u52a8",level:3},{value:"\u8bbe\u5907\u6811",id:"\u8bbe\u5907\u6811",level:4},{value:"\u6e29\u63a7",id:"\u6e29\u63a7",level:3},{value:"\u4ee3\u7801\u8def\u5f84",id:"\u4ee3\u7801\u8def\u5f84",level:4},{value:"menuconfig",id:"menuconfig",level:4},{value:"tsadc\u914d\u7f6e",id:"tsadc\u914d\u7f6e",level:4},{value:"Thermal Zone \u914d\u7f6e",id:"thermal-zone-\u914d\u7f6e",level:4},{value:"display",id:"display",level:2},{value:"\u9a71\u52a8\u5728\u54ea\u91cc\uff1f",id:"\u9a71\u52a8\u5728\u54ea\u91cc",level:3},{value:"uboot",id:"uboot",level:4},{value:"kernel",id:"kernel",level:4},{value:"4G Modern",id:"4g-modern",level:2}],s={toc:u};function k(e){var r=e.components,n=(0,o.Z)(e,a);return(0,l.kt)("wrapper",(0,t.Z)({},s,n,{components:r,mdxType:"MDXLayout"}),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"SDK\u4e3a\u91ce\u706b2023.9.16\u7684"),(0,l.kt)("p",{parentName:"blockquote"},"ubuntu22.06")),(0,l.kt)("h3",{id:"\u65b0\u5efa\u4ea7\u54c1lunch"},"\u65b0\u5efa\u4ea7\u54c1lunch"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u4fee\u6539device/rockchip/rk356x/AndroidProducts.mk\u589e\u52a0rk3568_r\u7684lunch")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"--- a/AndroidProducts.mk \n+++ b/AndroidProducts.mk \n@@ -17,10 +17,14 @@\nPRODUCT_MAKEFILES := \\\n\xa0 \xa0 \xa0 \xa0 $(LOCAL_DIR)/rk3566_rgo/rk3566_rgo.mk \\ \n\xa0 \xa0 \xa0 \xa0 $(LOCAL_DIR)/rk3566_r/rk3566_r.mk \\\n+ \xa0 \xa0 \xa0  $(LOCAL_DIR)/rk3568_r/rk3568_r.mk \\\n\nCOMMON_LUNCH_CHOICES := \\ \n\xa0 \xa0 rk3566_rgo-userdebug \\ \n\xa0 \xa0 rk3566_rgo-user \\\n\xa0 \xa0 rk3566_r-userdebug \\ \n\xa0 \xa0 rk3566_r-user \\\n+ \xa0  rk3568_r-userdebug \\ \n+ \xa0  rk3568_r-user \\\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5728device/rockchip/rk356x\u76ee\u5f55\u4e0b\u65b0\u5efark3568_r\u76ee\u5f55\n\u53c2\u8003device/rockchip/rk356x\u4e0b\u5df2\u6709\u7684rk3566_r\u4ea7\u54c1\u76ee\u5f55\u65b0\u5efa")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"service ril-daemon /vendor/bin/hw/rild\n    class main\n    user radio\n    group radio cache inet misc audio log readproc wakelock\n    capabilities BLOCK_SUSPEND NET_ADMIN NET_RAW\n")),(0,l.kt)("h2",{id:"cooling"},"cooling"),(0,l.kt)("h3",{id:"\u98ce\u6247\u542f\u52a8"},"\u98ce\u6247\u542f\u52a8\uff01"),(0,l.kt)("h4",{id:"\u8bbe\u5907\u6811"},"\u8bbe\u5907\u6811"),(0,l.kt)("p",null,"\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"rk3568-lubancat-2.dtsi"),"\u4e0b\uff0c\u627e\u5230"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-c"},'    fan: pwm-fan {\n        compatible = "pwm-fan";\n        #cooling-cells = <2>;\n        pwms = <&pwm0 0 500000 0>;\n        cooling-levels = <0 100 150 200 255>;\n        rockchip,temp-trips = <\n            50000   1\n            55000   2\n            60000   3\n            65000   4\n            70000   5\n        >;\n    };\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"50000"),"\u4e3a\u6e29\u5ea6\uff0c\u4fdd\u7559\u5c0f\u6570\u70b9\u540e\u4e09\u4f4d\uff0c\u53f3\u8fb9\u4e3a\u6863\u4f4d"),(0,l.kt)("p",null,"\u6ce8\u610f\u770b",(0,l.kt)("inlineCode",{parentName:"p"},"android11/kernel/arch/arm64/configs/rockchip_defconfig"),"\u662f\u5426\u5f00\u542f\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"CONFIG_SENSORS_PWM_FAN=y")),(0,l.kt)("p",null,"\u968f\u540e\u8fdb\u5165\u5b89\u5353adb shell"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"su\ncd /sys/class/thermal/cooling_device0\n")),(0,l.kt)("p",null,"\u4e0b\u9762\u5e94\u8be5\u4f1a\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"cur_state "),"\u548c",(0,l.kt)("inlineCode",{parentName:"p"},"max_state")),(0,l.kt)("p",null,"\u53ef\u4ee5echo 0-max_state\u5230cur_state\u6765\u63a7\u5236\u8f6c\u901f"),(0,l.kt)("p",null,"\u793a\u4f8b\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"echo 4>/sys/class/thermal/cooling_device0/cur_state")),(0,l.kt)("p",null,"\u5e94\u8be5\u80fd\u8d77\u98de\u4e86"),(0,l.kt)("h3",{id:"\u6e29\u63a7"},"\u6e29\u63a7"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5b98\u65b9\u6587\u6863\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"Android/common/Thermal/Rockchip_Developer_Guide_Thermal_CN.pdf")),(0,l.kt)("p",{parentName:"blockquote"},"\u5efa\u8bae\u89c2\u770b\u6e90\u6587\u6863\uff0c\u907f\u514d\u5438\u6536\u4e8c\u624b\u8d44\u6599\uff0c\u8fd9\u91cc\u4ec5\u505a",(0,l.kt)("strong",{parentName:"p"},"\u5feb\u901f\u4e86\u89e3\u7528"))),(0,l.kt)("p",null,"Thermal \u662f\u5185\u6838\u5f00\u53d1\u8005\u5b9a\u4e49\u7684\u4e00\u5957\u652f\u6301\u6839\u636e\u6307\u5b9a governor \u63a7\u5236\u7cfb\u7edf\u6e29\u5ea6\uff0c\u4ee5\u9632\u6b62\u82af\u7247\u8fc7\u70ed\u7684\u6846\u67b6\u6a21\u578b\u3002Thermal framework \u7531 ",(0,l.kt)("strong",{parentName:"p"},"governor"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"core"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"cooling device"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"sensor driver")," \u7ec4\u6210"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://pic.imgdb.cn/item/653e2230c458853aef8086b1",alt:"image-20231029171311411"})),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"\tgovernor"),"\uff1a\u7528\u4e8e\u51b3\u5b9a cooling device \u662f\u5426\u9700\u8981\u964d\u9891\uff0c\u964d\u5230\u4ec0\u4e48\u7a0b\u5ea6\u3002\u76ee\u524d Linux4.4 \u5185\u6838\u4e2d\u5305 \u542b\u4e86\u5982\u4e0b\u51e0\u79cd governor\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u51b3\u5b9a\u4e86\u51e0\u79cd\u6e29\u63a7\u7b56\u7565")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"core"),"\uff1a\u5bf9sensor driver \u548cgovernor\u62bd\u8c61\u5c01\u88c5\uff0c\u5e76\u63d0\u4f9b\u63a5\u53e3"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"sensor driver"),"\uff1a\u7528\u4e8e\u83b7\u53d6\u6e29\u5ea6\uff0c\u5982tsadc")),(0,l.kt)("h4",{id:"\u4ee3\u7801\u8def\u5f84"},"\u4ee3\u7801\u8def\u5f84"),(0,l.kt)("p",null,"Governor \u76f8\u5173\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"drivers/thermal/power_allocator.c \xa0 /* power allocator\u6e29\u63a7\u7b56\u7565 */\ndrivers/thermal/step_wise.c \xa0 \xa0 \xa0 \xa0 \xa0 \xa0/* step wise\u6e29\u63a7\u7b56\u7565    */\ndrivers/thermal/fair_share.c \xa0 \xa0 \xa0 \xa0 \xa0 /* fair share\u6e29\u63a7\u7b56\u7565    */\ndrivers/thermal/user_space.c \xa0 \xa0 \xa0 \xa0 \xa0 /* userspace\u6e29\u63a7\u7b56\u7565    */\n")),(0,l.kt)("p",null,"Cooling device \u76f8\u5173\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"drivers/thermal/devfreq_cooling.c \ndrivers/thermal/cpu_cooling.c\n")),(0,l.kt)("p",null,"Core \u76f8\u5173\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"drivers/thermal/thermal_core.c\n")),(0,l.kt)("p",null,"Driver \u76f8\u5173\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"drivers/thermal/rockchip_thermal.c \xa0 \xa0/* \u9664\u4e86RK3368\u5916\u7684\u5176\u4ed6\u5e73\u53f0\u7684tsadc\u9a71\u52a8    */ \ndrivers/thermal/rk3368_thermal.c \xa0 \xa0 \xa0/* RK3368\u5e73\u53f0tsadc\u9a71\u52a8    */\n")),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u4e4b\u524d\u8c03\u5b89\u5353\u6e29\u63a7\u7684\u65f6\u5019\u76f4\u63a5\u641ccompatible\u641c\u51fa\u6765\u7684pwm-fan\u7684\u9a71\u52a8\u5e76\u4e0d\u662f\u771f\u6b63\u7684\u6e29\u63a7\u4ee3\u7801\u3002\u3002\u3002")),(0,l.kt)("h4",{id:"menuconfig"},"menuconfig"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<*> Generic Thermal sysfs driver \xa0---\x3e \n    --- Generic Thermal sysfs driver\n    [*] \xa0 APIs to parse thermal data out of device tree \n    [*] \xa0 Enable writable trip points\n    Default Thermal governor (power_allocator) \xa0---\x3e \xa0/* default thermal governor*/\n    [ ] \xa0 Fair-share thermal governor\n    [ ] \xa0 Step_wise thermal governor \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0/* step_wise governor */\n    [ ] \xa0 Bang Bang thermal governor\n    [*] \xa0 User_space thermal governor \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 /* user_space governor */\n    -*- \xa0 Power allocator thermal governor \xa0 \xa0 \xa0 \xa0 \xa0\xa0/* power_allocatorgovernor */\n    [*] \xa0 generic cpu cooling support \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 /* cooling device */ \n    [ ] \xa0 Generic clock cooling support\n    [*] \xa0 Generic device cooling support \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0/* cooling device */ \n    [ ] \xa0 Thermal emulation mode support\n    < > \xa0 Temperature sensor driver for Freescale i.MX SoCs\n    <*> \xa0 Rockchip thermal driver \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0/* thermal sensor driver*/\n    < > \xa0 \xa0 rk_virtual thermal driver\n    <*> \xa0 \xa0 rk3368 thermal driver legacy \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0/* thermal sensor driver*/\n")),(0,l.kt)("p",null,"\u4fee\u6539Default Thermal governor\u6765\u4fee\u6539\u6e29\u63a7\u7b56\u7565"),(0,l.kt)("h4",{id:"tsadc\u914d\u7f6e"},"tsadc\u914d\u7f6e"),(0,l.kt)("p",null,"\u7528\u6765\u83b7\u53d6\u6e29\u5ea6"),(0,l.kt)("p",null,"\u5305\u542b\u5927\u91cfDTSI\uff0c\u53bb\u6e90\u6587\u6863\u770b\u5427"),(0,l.kt)("h4",{id:"thermal-zone-\u914d\u7f6e"},"Thermal Zone \u914d\u7f6e"),(0,l.kt)("p",null,"Termal zone \u8282\u70b9\u4e3b\u8981\u7528\u4e8e\u914d\u7f6e\u6e29\u63a7\u7b56\u7565\u76f8\u5173\u7684\u53c2\u6570\u5e76\u751f\u6210\u5bf9\u5e94\u7684\u7528\u6237\u6001\u63a5\u53e3\u3002"),(0,l.kt)("p",null,"\u4e5f\u662f\u5728dts\u91cc"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f88\u6709\u53ef\u80fd\u662f\u8fd9\u91cc\u914d\u7f6e\u7684\u95ee\u9898\uff0c\u8fd9\u91cc\u5305\u542b\u4e86\u6e29\u63a7\u7b56\u7565\u5f00\u59cb\u5de5\u4f5c\u9608\u503c\uff0c\u6bd4\u5982\u8bbe\u7f6e\u4e8670"),(0,l.kt)("p",{parentName:"blockquote"},"\u7b49\u670d\u52a1\u5668\u5230\u4e86\u6d4b\u8bd5\u4e00\u4e0b")),(0,l.kt)("h2",{id:"display"},"display"),(0,l.kt)("h3",{id:"\u9a71\u52a8\u5728\u54ea\u91cc"},"\u9a71\u52a8\u5728\u54ea\u91cc\uff1f"),(0,l.kt)("h4",{id:"uboot"},"uboot"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"drivers/video/drm/dw_mipi_dsi2.c \ndrivers/video/drm/samsung_mipi_dcphy.c\n")),(0,l.kt)("p",null,"\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"CONFIG_DRM_ROCKCHIP_DW_MIPI_DSI2=y \nCONFIG_DRM_ROCKCHIP_SAMSUNG_MIPI_DCPHY=y\n")),(0,l.kt)("h4",{id:"kernel"},"kernel"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"MIPI DSI-2 host controller:\ndrivers/gpu/drm/rockchip/dw-mipi-dsi2-rockchip.c \n\nMIPI DCPHY:\ndrivers/phy/rockchip/phy-rockchip-samsung-dcphy.c\n")),(0,l.kt)("p",null,"\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cONFIG_ROCKCHIP_DW_MIPI_DSI=y \nCONFIG_PHY_ROCKCHIP_SAMSUNG_DCPHY=y\n")),(0,l.kt)("h2",{id:"4g-modern"},"4G Modern"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'[   10.896941] type=1400 audit(1501837449.536:22): avc: denied { read } for comm="usb_dongle" name="loop1" dev="sysfs" ino=19885 scontext=u:r:usb_dongle:s0 tcontext=u:object_r:sysfs_loop:s0 tclass=dir permissive=1\n[   10.897158] type=1400 audit(1501837449.536:23): avc: denied { open } for comm="usb_dongle" path="/sys/devices/virtual/block/loop1" dev="sysfs" ino=19885 scontext=u:r:usb_dongle:s0 tcontext=u:object_r:sysfs_loop:s0 tclass=dir perm\n')))}k.isMDXComponent=!0}}]);